import{a as h,V as m,b as f,c as x,d as C,e as y}from"./VTextField-1d0d3849.js";import{_ as D,r as I,o as c,d,a as t,w as s,c as v,g as k,x as A,y as q,e as a,z as g,t as u,h as b,f as i}from"./index-a268a96b.js";import{V as _,a as T}from"./VDataTable-6a90e37e.js";import{V,a as w}from"./VDialog-5a5f5472.js";const S={name:"deals",data(){return{headers:[{text:"Seller",align:"start",sortable:!1,value:"seller"},{text:"ID Promoção",value:"promotion_id"},{text:"Type",value:"type"},{text:"Status",value:"status"},{text:"Start Date",value:"start_date"},{text:"Finish Date",value:"finish_date"},{text:"Deadline",value:"deadline_date"},{text:"Name",value:"name"},{text:"Benefits",value:"benefits"}],items:[],loadingtable:!1,selectedItem:{seller:"",promotion_id:"",type:"",status:"",start_date:"",finish_date:"",deadline_date:"",name:"",benefits:""},dialog:!1,markup:5,anuncios_aptos:0,isSubscribed:!1,currentChannelKey:null,subscription:null,processingDialog:!1,loading_promotion:!1}},created(){this.$store.dispatch("createCable"),this.getItems(),console.log("this.isProcessingPromotions()"),console.log(this.$store.state.isProcessingPromotions)},computed:{isProcessingPromotions(){return this.$store.state.isProcessingPromotions}},methods:{handleRowClick(e,o){console.log("Cliquei na linha!"),console.log(e),console.log(o),console.log(o.item.seller),console.log(o.item.promotion_id),console.log(o.item.type),this.isProcessingPromotions?this.processingDialog=!0:(this.loadingtable=!0,this.abrirPromocao(o))},abrirPromocao(e){this.selectedItem=e.item,h.post("https://sea-turtle-app-2-m3wfm.ondigitalocean.app/seller/promotion-data",{promotion_data:{promotion_id:this.selectedItem.promotion_id,type:this.selectedItem.type,seller:this.selectedItem.seller}},{headers:{Authorization:this.$store.state.authToken}}).then(o=>{this.anuncios_aptos=o.data.total_items}).catch(o=>{console.log(o),o.request.status===401&&(console.log("--- user não está logado ---:"),this.$router.push("login"))}).finally(()=>{this.loadingtable=!1,this.dialog=!0})},close(){this.dialog=!1},getItems(){this.loadingtable=!0,h.get("https://sea-turtle-app-2-m3wfm.ondigitalocean.app/seller/promotions",{headers:{Authorization:this.$store.state.authToken}}).then(e=>{this.items=e.data,console.log(e.data),this.loadingtable=!1}).catch(e=>{console.log(e),e.request.status===401&&(console.log("--- user não está logado ---:"),this.$router.push("login")),this.loadingtable=!1}),h.get("https://sea-turtle-app-2-m3wfm.ondigitalocean.app/seller/promotions-status",{headers:{Authorization:this.$store.state.authToken}}).then(e=>{console.log("Pegando via axios se existe alguma promocao sendo processada"),console.log(e.data)}).catch(e=>{console.log(e)}).finally(()=>{console.log("Atualiza o status do processamente - falta colocar issno codigo")})},ativarPromocao(){this.loading_promotion=!0;const e=this.$store.state.cable;if(console.log("Cable instance from Vuex:",e),!e){console.error("Action Cable consumer instance is not available.");return}this.subscription&&(console.log("Limpando subscription 1 se houver"),this.subscription.unsubscribe());const o=`${this.selectedItem.promotion_id}_${this.selectedItem.seller}`;console.log(o),this.subscription=e.subscriptions.create({channel:"PromotionNotificationChannel",channel_key:o},{received:r=>{console.log("Received data:",r),r.status==="processing_promotions"&&this.$store.dispatch("setProcessingPromotions",!0),r.status==="completed"&&(this.$store.dispatch("setProcessingPromotions",!1),console.log("Dispatched to setProcessingPromotions with false"),this.subscription&&this.subscription.unsubscribe())}}),console.log(this.selectedItem.name),console.log(this.markup),h.post("https://sea-turtle-app-2-m3wfm.ondigitalocean.app/seller/activate-promotion",{promotion_data:{promotion_id:this.selectedItem.promotion_id,type:this.selectedItem.type,seller:this.selectedItem.seller}},{headers:{Authorization:this.$store.state.authToken}}).then(r=>{console.log(r)}).catch(r=>{console.log("Deu erro, log do erro abaixo:"),console.log(r),r.request.status===401&&(console.log("--- user não está logado ---:"),this.$router.push("login"))}).finally(()=>{this.dialog=!1,this.loading_promotion=!1})},itemRowBackground(e){if(console.log("Entre na funcao da cor"),e.store_quantity<10&&e.flex==!0)return"style-1";if(e.store_quantity>20&&e.flex==!0)return"style-2";if(e.store_quantity<20&&e.store_quantity>10&&e.flex==!0)return"style-3";if(e.store_quantity<20&&e.store_quantity>10&&e.flex==!1||e.store_quantity>20&&e.flex==!1)return"style-1";if(e.store_quantity<10&&e.flex==!1)return"style-2"}}},z={key:0,height:"400px"},B=i("br",null,null,-1),j=i("br",null,null,-1),N=i("br",null,null,-1),F=i("br",null,null,-1),R=i("br",null,null,-1),U=i("br",null,null,-1),E=i("br",null,null,-1),K={key:0},L=i("br",null,null,-1),M=i("br",null,null,-1),G={key:1},H=i("br",null,null,-1),J=i("br",null,null,-1),O={key:1,class:"d-flex justify-center align-center",style:{height:"200px"}};function Q(e,o,r,W,l,p){const P=I("v-flex");return c(),d("div",null,[l.loadingtable==!0?(c(),d("div",z,[t(P,null,{default:s(()=>[t(m,{class:"d-flex align-center justify-center",height:"400px"},{default:s(()=>[t(k,{size:50,indeterminate:"",color:"primary"})]),_:1})]),_:1})])):(c(),v(m,{key:1,class:"pa-8",outlined:"",tile:""},{default:s(()=>[t(T,{headers:l.headers,items:l.items,class:"elevation-1","sort-by":["seller"],"must-sort":"","onClick:row":p.handleRowClick},{top:s(()=>[t(A,{flar:""},{default:s(()=>[t(q,null,{default:s(()=>[a("Controle de Promoções")]),_:1}),t(_,{class:"mx-4",inset:"",vertical:""}),t(g)]),_:1}),t(V,{modelValue:l.dialog,"onUpdate:modelValue":o[1]||(o[1]=n=>l.dialog=n),persistent:"","max-width":l.loading_promotion?"auto":"600px",class:"mx-auto my-20"},{default:s(()=>[l.loading_promotion?(c(),d("div",O,[t(k,{indeterminate:"",color:"primary",size:"64"})])):(c(),v(m,{key:0,flat:""},{default:s(()=>[t(_,{class:"mx-4"}),t(f,{class:"justify-center text-h5"},{default:s(()=>[a(u(l.selectedItem.name),1)]),_:1}),t(_,{class:"mx-4"}),B,t(x,{class:"text-h6"},{default:s(()=>[a(" Tipo: "+u(l.selectedItem.type),1),j,N,a(" Seller: "+u(l.selectedItem.seller),1),F,R,a(" Status: "+u(l.selectedItem.status),1),U,E,l.anuncios_aptos<200?(c(),d("div",K,[a("Anúncios Aptos: "+u(l.anuncios_aptos),1),L,M])):(c(),d("div",G,[a("Anúncios Aptos: +200"),H,J]))]),_:1}),t(_,{class:"mx-4"}),t(f,null,{default:s(()=>[a("Ativação de Anúncios")]),_:1}),t(w,{cols:"12",md:"4"},{default:s(()=>[t(C,{modelValue:l.markup,"onUpdate:modelValue":o[0]||(o[0]=n=>l.markup=n),label:"Markup Desejado",required:"","hide-details":"",type:"number",min:"0",hint:"Apenas os anúncios que atenderem serão ativados","prepend-inner-icon":"mdi-percent-box"},null,8,["modelValue"])]),_:1}),t(y,null,{default:s(()=>[t(b,{color:"deep-purple lighten-2",disabled:p.isProcessingPromotions,text:"",onClick:p.ativarPromocao},{default:s(()=>[a(" Ativar todos ")]),_:1},8,["disabled","onClick"]),t(g),t(b,{color:"blue darken-1",text:"",onClick:p.close},{default:s(()=>[a("Fechar")]),_:1},8,["onClick"])]),_:1})]),_:1}))]),_:1},8,["modelValue","max-width"]),t(V,{modelValue:l.processingDialog,"onUpdate:modelValue":o[3]||(o[3]=n=>l.processingDialog=n),persistent:"","max-width":"300px"},{default:s(()=>[t(m,null,{default:s(()=>[t(f,{class:"headline"},{default:s(()=>[a("Processamento em Andamento")]),_:1}),t(x,null,{default:s(()=>[a("Um conjunto de promoções está sendo ativado. Por favor, aguarde a conclusão.")]),_:1}),t(y,null,{default:s(()=>[t(g),t(b,{color:"green darken-1",text:"",onClick:o[2]||(o[2]=n=>l.processingDialog=!1)},{default:s(()=>[a("Fechar")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),"item.benefits":s(({item:n})=>[i("p",null,"MercadoLivre: "+u(n.benefits?n.benefits.meli_percent:"")+"%",1),i("p",null,"Seller: "+u(n.benefits?n.benefits.seller_percent:"")+"%",1)]),_:1},8,["headers","items","onClick:row"])]),_:1}))])}const ee=D(S,[["render",Q]]);export{ee as default};
